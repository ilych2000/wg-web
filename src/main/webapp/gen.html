<!DOCTYPE html><html><head><title>Расчет показателей технического состояния (Тсy) и	безопасности (БСсц)</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><link rel="stylesheet" href="css/normalize.css"><script src="js/debug.js"></script><script src="js/jquery-latest.js"></script><script src="js/lib.js"></script><script src="bs3/js/bootstrap.min.js"></script><link href="bs3/css/bootstrap.min.css" rel="stylesheet"><link rel="stylesheet" href="css/style.css"><link rel="stylesheet" href="css/lib.css"><script src="js/ajax_lib.js"></script><script src="js/main.js"></script><script type="text/javascript">currentCalculateID = 2;function doMenuClick(el) {	$curentActivMenu.removeClass("active");	$curentActivMenu = $(el.parentElement).addClass("active");		switch (el.id) {	case 'FACT_VALUE':		loadPageToWork('pages/fact_zn' + currentCalculateID + '.htm');		break;	case 'SEL_CRIT':		loadPageToWork('pages/critery' + currentCalculateID + '.htm');		break;	case 'SCENARY':		loadPageToWork('pages/scenary' + currentCalculateID + '.htm');		break;	case 'SCENARY_FULL':		loadPageToWork('pages/temp_dic_scen.htm');		break;	case 'EVAL_TABLE':		loadPageToWork('pages/rasch_tab' + currentCalculateID + '.htm');		break;	case 'ALL_REZULT':		loadPageToWork('pages/all_result' + currentCalculateID + '.htm');		break;	}}	var SQL_INSERT_SC_GROUPE = "";//"INSERT INTO SCENARIOS_GROUP(ID, NAME) VALUES(!ID!, '!NAME!')";	var SQL_INSERT_SCERARIO = "INSERT INTO SCENARIOS (ID, NAME,NPP, OBJECT_TYPE_ID, SCENARIOS_GROUP_ID, CALCULATION_ID, RANK ) VALUES(null, '!NAME!','!NPP!', 2, !SCENARIOS_GROUP_ID!, 2, 1)";	function generateSC() {		$sql = $('#sql').empty();		var $trs = $workPanel.find('table tr');		//alert($trs.length);		var scGroupI = 0;		$.each($trs, function(index, row) {			var $row = $(row);			var text = $row.text().trim();			if (!isNaN(text[0])) {				var npp = $row.find('td:nth-child(1)').text().trim();				var name = $row.find('td:nth-child(2)').text().trim();				if (name[0] == '-') {					name = $.trim(name.substr(1));				}				$sql.append(SQL_INSERT_SCERARIO.replace('!NAME!', name)						.replace('!NPP!', $.trim(npp.replace(',', '.')))						.replace('!SCENARIOS_GROUP_ID!', scGroupI)						+ ';<br>');				//if ()			} else {				if (text.indexOf('ГРУППА') != -1) {					$sql.append(SQL_INSERT_SC_GROUPE							.replace('!ID!', ++scGroupI)							.replace('!NAME!', text)							+ ';<br>');				}			}		});	}	var SQL_INSERT_SAFETY_GROUP = "";//"INSERT INTO SAFETY_GROUP (ID, NAME) VALUES(!ID!, '!NAME!')";	var SQL_INSERT_CRITERIA = "INSERT INTO CRITERIA (ID, NAME, SIGN, NPP, SAFETY_GROUP_ID, OBJECT_TYPE_ID, CALCULATION_ID) VALUES(!ID!, '!NAME!', '!SIGN!', '!NPP!', !SAFETY_GROUP_ID!, 2, 2)";	var SQL_INSERT_CALCULATION_CRITERIA = "INSERT INTO CALCULATION_CRITERIA (ID, CRITERIA_ID, K1, K2 ,K3, ACTUAL_VALUE, FI, CALCULATION_ID ) VALUES(NULL, !CRITERIA_ID!, '!K1!', '!K2!' ,'!K3!', '!ACTUAL_VALUE!', '!FI!', 2)";	function generateFK() {		$sql = $('#sql').empty();		$sql				.append("INSERT INTO SAFETY_GROUP (ID, NAME) VALUES(1, 'Критерии безопасности группы А');<br>");		var $trs = $workPanel.find('table tr');		//alert($trs.length);		var scGroupI = 1;		var fkI = 200;		var k1;		var k2;		var k3;		$.each($trs, function(index, row) {			var $row = $(row);			var text = $row.text().trim();			if (!isNaN(text[0])) {				var npp = $row.find('td:nth-child(1)').text().trim();				var sign = $row.find('td:nth-child(2)').text().trim();				var name = $row.find('td:nth-child(3)').text().trim();				var aval;				var fval;				//$sql.append($row.find('td').length + " ------------- <br>");				if ($row.find('td').length >= 8) {					k1 = $row.find('td:nth-child(4)').text().trim();					k2 = $row.find('td:nth-child(5)').text().trim();					k3 = $row.find('td:nth-child(6)').text().trim();					aval = $row.find('td:nth-child(7)').text().trim();					fval = $row.find('td:nth-child(8)').text().trim();				} else {					aval = $row.find('td:nth-child(4)').text().trim();					fval = $row.find('td:nth-child(5)').text().trim();				}				if (name[0] == '-') {					name = $.trim(name.substr(1));				}				$sql.append(SQL_INSERT_CRITERIA.replace('!ID!', ++fkI).replace(						'!NAME!', name).replace('!SIGN!', sign).replace(						'!NPP!', $.trim(npp.replace(',', '.'))).replace(						'!SAFETY_GROUP_ID!', scGroupI)						+ ';<br>');				$sql.append(SQL_INSERT_CALCULATION_CRITERIA.replace('!CRITERIA_ID!',						fkI).replace('!K1!', k1).replace('!K2!', k2).replace(						'!K3!', k3).replace('!ACTUAL_VALUE!', aval).replace(						'!FI!', fval)						+ ';<br>');			} else {				if (text.indexOf('безопасности группы') != -1) {					$sql.append(SQL_INSERT_SAFETY_GROUP.replace('!ID!',							++scGroupI).replace('!NAME!', text)							+ ';<br>');				}			}		});	}	var SQL_INSERT_CONTROL = "INSERT INTO CONTROL (ID, NAME) VALUES(!ID!, '!NAME!')";	var SQL_INSERT_AREA = "INSERT INTO AREA (ID, NAME, CONTROL_ID ) VALUES(!ID!, '!NAME!', !CONTROL_ID!)";	var SQL_INSERT_UZEL = "INSERT INTO UZEL (ID, NAME, AREA_ID ) VALUES(!ID!, '!NAME!', !AREA_ID!)";	var SQL_INSERT_OBJECT = "INSERT INTO OBJECT (ID, NAME, UZEL_ID, OBJECT_TYPE_ID ) VALUES(NULL, '!NAME!', !UZEL_ID!, !OBJECT_TYPE_ID!)";	function generateSTR() {		$sql = $('#sql').empty();		var $trs = $workPanel.find('table tr');		//alert($trs.length);		var controlID = 0;		var areaID = 0;		var uzelID = 0;        var initControl = true;        var initArea = true;        		var contrText; 		var areaText;				$.each($trs, function(index, row) {			var $row = $(row);			var text = $row.text().trim();			if ($row.find('td').length == 1) {				$sql.append(SQL_INSERT_CONTROL.replace('!ID!', ++controlID)						.replace('!NAME!', text)						+ ';<br>');				contrText = text;				initControl = true;			} else {				areaText = $row.find('td:nth-child(1)').text().trim();				if (areaText != '') {					$sql.append(SQL_INSERT_AREA.replace('!ID!', ++areaID)							.replace('!NAME!', areaText).replace('!CONTROL_ID!',									controlID)							+ ';<br>');					initArea = true;				} else if (initControl) {					$sql.append(SQL_INSERT_AREA.replace('!ID!', ++areaID)							.replace('!NAME!', contrText).replace('!CONTROL_ID!',									controlID)							+ ';<br>');					areaText = contrText;					initArea = true;				}				uzelText = $row.find('td:nth-child(2)').text().trim();				if (uzelText != '') {					$sql.append(SQL_INSERT_UZEL.replace('!ID!', ++uzelID)							.replace('!NAME!', uzelText).replace('!AREA_ID!',									areaID)							+ ';<br>');									} else if (initArea) {					$sql.append(SQL_INSERT_UZEL.replace('!ID!', ++uzelID)							.replace('!NAME!', areaText).replace('!AREA_ID!',									areaID)							+ ';<br>');					uzelText = areaText;				}				var $objects = $row.find('td:nth-child(3)').find('p');				$.each($objects, function(index, obj) {					var name = $(obj).text().trim();					if (name != '') {						if (name[0] == '-') {							name = $.trim(name.substr(1));						}						var objType = 2;						if (name.toLowerCase().indexOf('шлюз') != -1) {							objType = 1;						}						$sql.append(SQL_INSERT_OBJECT.replace(								'!OBJECT_TYPE_ID!', objType).replace('!NAME!',								name).replace('!UZEL_ID!', uzelID)								+ ';<br>');					}				});				initArea = false;				initControl = false;			}		});	}	var SQL_INSERT_SC_GROUPE = "";//"INSERT INTO SCENARIOS_GROUP(ID, NAME) VALUES(!ID!, '!NAME!')";	var SQL_INSERT_SCENARIO_FULL = "INSERT INTO SCENARIOS (ID, NAME,NPP, OBJECT_TYPE_ID, SCENARIOS_GROUP_ID, CALCULATION_ID, RANK ) VALUES(null, '!NAME!','!NPP!', !OBJECT_TYPE_ID!, !SCENARIOS_GROUP_ID!, 2, 1)";		var SQL_INSERT_OBJECT_TYPE_ID = "INSERT INTO OBJECT_TYPE(ID, NAME) VALUES(!ID!, '!NAME!')";		var objTypeID = 9;	var scGroupID = '-------------------------';		function generateSCFull() {		$sql = $('#sql').empty();		var $trs = $workPanel.find('table tr');		$.each($trs, function(index, row) {			var $row = $(row);			var text = $row.text().trim();			if (text == '') {				return true;			}			if (!isNaN(text[0])) {								var sp = text.indexOf(' ');				var npp = text.substr(0, sp+1);						var name = text.substr(sp);				$sql.append(SQL_INSERT_SCENARIO_FULL.replace('!NAME!', name)						.replace('!NPP!', $.trim(npp.replace(/[.]\s/, '')))						.replace('!SCENARIOS_GROUP_ID!', scGroupID)						.replace('!OBJECT_TYPE_ID!', objTypeID)						+ ';<br>');				//if ()			} else 				if (text.indexOf('ГРУППА') != -1) {					if (text.indexOf('1,0') != -1)						scGroupID = 1;					else					if (text.indexOf('0,9') != -1)						scGroupID = 2;					else					if (text.indexOf('0,8') != -1)						scGroupID = 3;					else						scGroupID = '-------------------------------';				}				else 					 {						$sql.append(SQL_INSERT_OBJECT_TYPE_ID								.replace('!ID!', ++objTypeID)								.replace('!NAME!', text)								+ ';<br>');					}		});	}	</script></head><body>	<div id="tinyCenterContent" class="tinyContent"></div>	<div id="loading" class="centerContent tinyContent">		<span> <img src="img/bigLoading32.gif" width="32" height="32">		</span>	</div>	<div id="enterForm" class="container-fluid">		<div class="row">			<div class="col-md-12 panel">				<div id="sql" style="font-size: 11px; font-weight: bold;"></div>			</div>		</div>		<div class="row">			<div class="col-md-12 panel">				<div class="btn-group">					<button type="button" class="btn btn-default"						onclick="generateSCFull()">Сцерарий полный</button>					<button type="button" class="btn btn-default"						onclick="generateSC()">Сцерарий</button>					<button type="button" class="btn btn-default"						onclick="generateFK()">Факт значения</button>					<button type="button" class="btn btn-default"						onclick="loadPageToWork('pages/struct.htm');">Загрузка						структуры</button>					<button type="button" class="btn btn-default"						onclick="generateSTR()">Структура</button>				</div>				<div class="panel panel-default">					<ul id="menu" class="nav nav-tabs">						<li><a id="SCENARY_FULL">Сценарии аварий</a></li>						<li><a id="FACT_VALUE" href="#">Фактические значения</a></li>						<li><a id="SEL_CRIT" href="#">Подбор критериев</a></li>						<li><a id="SCENARY" href="#">Сценарии аварий</a></li>						<li><a id="EVAL_TABLE" href="#">Расчетная таблица</a></li>						<li><a id="ALL_REZULT" href="#">Результат общий</a></li>					</ul>					<div id="workPanel" class="panel-body"></div>				</div>			</div>		</div>	</div></body></html>